<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>キューの図解</title>
    <link rel="stylesheet" href="./../../../styles.css">
    <style>        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        #value-input {
            padding: 8px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 80px;
        }
        
        .queue-container {
            position: relative;
            height: 150px;
            margin: 20px auto;
            overflow: hidden;
            background-color: white;
        }
        
        .queue-elements {
            display: flex;
            height: 100%;
            position: relative;
        }
        
        .queue-element {
            width: 60px;
            height: 60px;
            margin: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #4285f4;
            color: white;
            font-size: 20px;
            font-weight: bold;
            border-radius: 8px;
            position: relative;
            transition: all 0.5s ease;
        }
        
        .queue-element.enqueuing {
            animation: enqueue-animation 1s;
        }
        
        .queue-element.dequeuing {
            animation: dequeue-animation 1s;
            opacity: 0;
        }
        
        .queue-element.peeking {
            animation: peek-animation 1s;
        }
        
        .pointers {
            position: absolute;
            width: 100%;
            height: 40px;
            bottom: 0;
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
            box-sizing: border-box;
        }
        
        .pointer {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-weight: bold;
        }
        
        .pointer:before {
            content: '↑';
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .front-pointer {
            color: #d23f31;
        }
        
        .rear-pointer {
            color: #0f9d58;
        }
        
        .info-panel {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .status {
            margin: 0;
            font-size: 16px;
            color: #555;
        }
        
        .highlight {
            font-weight: bold;
            color: #4285f4;
        }
        
        @keyframes enqueue-animation {
            0% {
                transform: translateY(-100px);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes dequeue-animation {
            0% {
                transform: translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateX(-100px);
                opacity: 0;
            }
        }
        
        @keyframes peek-animation {
            0% { background-color: #4285f4; }
            50% { background-color: #fbbc05; }
            100% { background-color: #4285f4; }
        }
    </style>
</head>
<body>
    <ul class="breadcrumb">
        <li><a href="./../../../">アルゴリズムの学習</a></li>
        <li><a href="./../../">データ構造の問題</a></li>
        <li><a href="./../">キュー</a></li>
        <li>図解</li>
    </ul>

    <div class="container">
        <h1>キューの図解</h1>
    
        <div class="controls">
            <input type="number" id="value-input" placeholder="値" min="0" max="999" value="42">
            <button id="enqueue-btn">Enqueue</button>
            <button id="dequeue-btn">Dequeue</button>
            <button id="peek-btn">Peek</button>
            <button id="clear-btn">クリア</button>
        </div>
        
        <div class="queue-container">
            <div class="queue-elements" id="queue-elements"></div>
            <div class="pointers">
                <div class="pointer front-pointer" id="front-pointer">先頭</div>
                <div class="pointer rear-pointer" id="rear-pointer">末尾</div>
            </div>
        </div>
        
        <div class="info-panel">
            <p class="status" id="status">キューを操作するには上のボタンを使用してください。</p>
            <p>キュー要素数: <span class="highlight" id="queue-size">0</span></p>
        </div>    
    </div>

    <script>
        class Queue {
            constructor() {
                this.elements = [];
                this.frontIndex = 0;
                this.rearIndex = -1;
            }
            
            enqueue(element) {
                this.rearIndex++;
                this.elements[this.rearIndex] = element;
                return element;
            }
            
            dequeue() {
                if (this.isEmpty()) {
                    return null;
                }
                const element = this.elements[this.frontIndex];
                this.frontIndex++;
                // 再整列する処理（最適化のため）
                if (this.frontIndex * 2 >= this.elements.length) {
                    this.elements = this.elements.slice(this.frontIndex);
                    this.rearIndex -= this.frontIndex;
                    this.frontIndex = 0;
                }
                return element;
            }
            
            peek() {
                if (this.isEmpty()) {
                    return null;
                }
                return this.elements[this.frontIndex];
            }
            
            isEmpty() {
                return this.frontIndex > this.rearIndex;
            }
            
            clear() {
                this.elements = [];
                this.frontIndex = 0;
                this.rearIndex = -1;
            }
            
            size() {
                return this.isEmpty() ? 0 : this.rearIndex - this.frontIndex + 1;
            }
            
            getAllElements() {
                return this.elements.slice(this.frontIndex, this.rearIndex + 1);
            }
        }
        
        // DOMエレメント
        const valueInput = document.getElementById('value-input');
        const enqueueBtn = document.getElementById('enqueue-btn');
        const dequeueBtn = document.getElementById('dequeue-btn');
        const peekBtn = document.getElementById('peek-btn');
        const clearBtn = document.getElementById('clear-btn');
        const queueElementsContainer = document.getElementById('queue-elements');
        const frontPointer = document.getElementById('front-pointer');
        const rearPointer = document.getElementById('rear-pointer');
        const statusElement = document.getElementById('status');
        const queueSizeElement = document.getElementById('queue-size');
        
        // キューの初期化
        const queue = new Queue();
        
        // ボタン操作
        enqueueBtn.addEventListener('click', () => {
            const value = valueInput.value || Math.floor(Math.random() * 100);
            enqueue(value);
        });
        
        dequeueBtn.addEventListener('click', () => {
            dequeue();
        });
        
        peekBtn.addEventListener('click', () => {
            peek();
        });
        
        clearBtn.addEventListener('click', () => {
            clearQueue();
        });
        
        // キューUI更新関数
        function updateQueueUI() {
            queueElementsContainer.innerHTML = '';
            
            const elements = queue.getAllElements();
            elements.forEach((element, index) => {
                const elementDiv = document.createElement('div');
                elementDiv.className = 'queue-element';
                elementDiv.textContent = element;
                queueElementsContainer.appendChild(elementDiv);
            });
            
            queueSizeElement.textContent = queue.size();
            
            // ポインターの位置調整
            if (queue.isEmpty()) {
                frontPointer.style.display = 'none';
                rearPointer.style.display = 'none';
            } else {
                frontPointer.style.display = 'flex';
                rearPointer.style.display = 'flex';
                
                // ポインターの位置調整
                const elementWidth = 70; // 要素の幅 + マージン
                frontPointer.style.left = `${10}px`;
                rearPointer.style.left = `${10 + (queue.size() - 1) * elementWidth}px`;
            }
            
            // ボタンの有効/無効
            dequeueBtn.disabled = queue.isEmpty();
            peekBtn.disabled = queue.isEmpty();
        }
        
        // エンキュー操作
        function enqueue(value) {
            queue.enqueue(value);
            
            const elementDiv = document.createElement('div');
            elementDiv.className = 'queue-element enqueuing';
            elementDiv.textContent = value;
            queueElementsContainer.appendChild(elementDiv);
            
            statusElement.innerHTML = `<span class="highlight">${value}</span> をキューに追加しました`;
            
            setTimeout(() => {
                updateQueueUI();
            }, 1000);
        }
        
        // デキュー操作
        function dequeue() {
            if (queue.isEmpty()) {
                statusElement.textContent = 'キューは空です';
                return;
            }
            
            const dequeuedValue = queue.peek();
            const firstElement = queueElementsContainer.firstElementChild;
            firstElement.classList.add('dequeuing');
            
            statusElement.innerHTML = `<span class="highlight">${dequeuedValue}</span> をキューから取り出しました`;
            
            setTimeout(() => {
                queue.dequeue();
                updateQueueUI();
            }, 1000);
        }
        
        // ピーク操作
        function peek() {
            if (queue.isEmpty()) {
                statusElement.textContent = 'キューは空です';
                return;
            }
            
            const peekedValue = queue.peek();
            const firstElement = queueElementsContainer.firstElementChild;
            firstElement.classList.add('peeking');
            
            statusElement.innerHTML = `先頭要素は <span class="highlight">${peekedValue}</span> です（取り出しはしません）`;
            
            setTimeout(() => {
                firstElement.classList.remove('peeking');
            }, 1000);
        }
        
        // クリア操作
        function clearQueue() {
            queue.clear();
            updateQueueUI();
            statusElement.textContent = 'キューをクリアしました';
        }
        
        // 初期状態の更新
        updateQueueUI();
    </script>
</body>
</html>

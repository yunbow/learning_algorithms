<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHA-1/SHA-2/SHA-3</title>
    <link rel="stylesheet" href="./../../styles.css">
</head>
<body>
    <ul class="breadcrumb">
        <li><a href="./../../">アルゴリズムの学習</a></li>
        <li><a href="./../">ハッシュ文字列の問題</a></li>
        <li>SHA-1/SHA-2/SHA-3</li>
    </ul>
    <div class="container">
        <h1>SHA-1/SHA-2/SHA-3</h1>
        <div class="section">
            <h2>アルゴリズムの概要</h2>
            <p>SHA（Secure Hash Algorithm）は、任意の長さのデータから固定長の文字列（ハッシュ値）を生成するハッシュ関数の一種です。米国国立標準技術研究所（NIST）によって標準化され、デジタル署名やデータの整合性確認などに広く使用されています。</p>
            
            <h3>基礎知識</h3>
            <p>ハッシュ関数とは、任意の大きさのデータを入力として受け取り、固定長の出力（ハッシュ値）を生成する数学的関数です。暗号学的ハッシュ関数は以下の性質を持つように設計されています：</p>
            <ul>
                <li><strong>一方向性</strong>：ハッシュ値から元のデータを復元することが計算量的に不可能</li>
                <li><strong>衝突耐性</strong>：同じハッシュ値を持つ異なる入力を見つけることが困難</li>
                <li><strong>雪崩効果</strong>：入力のわずかな変化でもハッシュ値が大きく変化する</li>
            </ul>
            <p>SHA関数は、その名前の数字が大きいほど新しく、セキュリティ強度も高くなる傾向があります。SHA-1は現在は安全ではないとされ、SHA-2と後継のSHA-3が現代の暗号システムで使用されています。</p>
            
            <h3>用語説明</h3>
            <ul>
                <li><strong>ハッシュ値（hash value）</strong>：ハッシュ関数によって生成された固定長の出力</li>
                <li><strong>メッセージダイジェスト（message digest）</strong>：ハッシュ値の別名</li>
                <li><strong>衝突（collision）</strong>：異なる入力データから同じハッシュ値が生成される状況</li>
                <li><strong>プリイメージ耐性（preimage resistance）</strong>：与えられたハッシュ値に対して、そのハッシュ値を生成する元データを見つけることの難しさ</li>
                <li><strong>パディング（padding）</strong>：入力データの長さを調整するために追加するビット列</li>
                <li><strong>圧縮関数（compression function）</strong>：ハッシュアルゴリズム内で使用される、固定長のブロックを処理する関数</li>
                <li><strong>メルクルダムゴード構造（Merkle–Damgård construction）</strong>：SHA-1とSHA-2で使用される基本構造</li>
                <li><strong>スポンジ構造（sponge construction）</strong>：SHA-3で採用された新しい構造</li>
                <li><strong>ラウンド（round）</strong>：ハッシュ計算中に繰り返し実行される処理ステップ</li>
            </ul>
            
            <h3>特徴</h3>
            <p>各SHAアルゴリズムの主な特徴は以下の通りです：</p>
            
            <h4>SHA-1</h4>
            <ul>
                <li>1995年に開発され、160ビット（40文字の16進数）のハッシュ値を生成</li>
                <li>メルクルダムゴード構造に基づく</li>
                <li>2005年以降、理論的な脆弱性が発見され、2017年に実際の衝突例が報告</li>
                <li>現在はセキュリティ用途での使用は推奨されていない</li>
            </ul>
            
            <h4>SHA-2</h4>
            <ul>
                <li>SHA-1の脆弱性に対応して2001年に開発</li>
                <li>複数のバリエーションを含む：SHA-224、SHA-256、SHA-384、SHA-512、SHA-512/224、SHA-512/256</li>
                <li>名前の数字はハッシュ値のビット長を示す（例：SHA-256は256ビット＝64文字の16進数）</li>
                <li>SHA-1と同様にメルクルダムゴード構造を基にしているが、より複雑な内部関数を使用</li>
                <li>現在も広く使用され、安全と考えられている</li>
            </ul>
            
            <h4>SHA-3</h4>
            <ul>
                <li>2015年に米国連邦標準として採用された最新のSHA標準</li>
                <li>Keccak（ケチャック）アルゴリズムをベースとしている</li>
                <li>従来のSHAとは大きく異なるスポンジ構造を採用</li>
                <li>SHA-2と同様のビット長のバリエーションを持つ：SHA3-224、SHA3-256、SHA3-384、SHA3-512</li>
                <li>量子コンピュータへの耐性も考慮された設計</li>
                <li>SHAKE128、SHAKE256という拡張可能な出力機能（XOF）も規定</li>
            </ul>
            
            <h3>適用ケース</h3>
            <p>SHAアルゴリズムは以下のような様々な用途で使用されています：</p>
            <ul>
                <li><strong>デジタル署名</strong>：文書の整合性を検証し、送信者を認証するため</li>
                <li><strong>TLS/SSLプロトコル</strong>：安全なウェブ通信の確立に使用</li>
                <li><strong>ブロックチェーン技術</strong>：トランザクションの検証やマイニングプロセス</li>
                <li><strong>パスワード保存</strong>：平文でのパスワード保存を避けるため（ソルトと組み合わせて使用）</li>
                <li><strong>ファイルの整合性確認</strong>：ダウンロードしたファイルが改ざんされていないことを確認</li>
                <li><strong>Git等のバージョン管理システム</strong>：コミットやファイルの一意識別子として</li>
                <li><strong>データ重複排除</strong>：同一データを識別するための効率的な方法として</li>
                <li><strong>乱数生成</strong>：暗号学的に安全な乱数の生成に利用</li>
                <li><strong>メッセージ認証コード（HMAC）</strong>：メッセージの認証と整合性確保のため</li>
            </ul>
            
            <p>現在のセキュリティ要件に基づいた推奨使用法は以下の通りです：</p>
            <ul>
                <li>新規のアプリケーションではSHA-2（特にSHA-256以上）またはSHA-3を使用すべき</li>
                <li>高いセキュリティが必要な場合や将来的な安全性を考慮する場合はSHA-3がより適切</li>
                <li>SHA-1は互換性のためにのみ使用し、できるだけ早期に強力なアルゴリズムに移行すべき</li>
            </ul>
        </div>
    
        <div class="section">
            <h2>アルゴリズムの手順</h2>
            <h3>具体的な手順</h3>
            
            <h4>SHA-1の手順</h4>
            <ol>
                <li><strong>前処理</strong>：
                    <ol>
                        <li>入力メッセージに「1」ビットを追加</li>
                        <li>メッセージの長さが448 mod 512に等しくなるまで「0」ビットを追加</li>
                        <li>元のメッセージ長（64ビット）を追加し、512ビットの倍数にする</li>
                    </ol>
                </li>
                <li><strong>初期ハッシュ値の設定</strong>：
                    <p>5つの32ビット値（合計160ビット）を初期ハッシュ値として設定</p>
                </li>
                <li><strong>メッセージの処理</strong>：
                    <ol>
                        <li>メッセージを512ビットのブロックに分割</li>
                        <li>各ブロックを16個の32ビットのワードに分割</li>
                        <li>16ワードから80ワードに拡張</li>
                        <li>5つの変数を初期ハッシュ値で初期化</li>
                        <li>80ラウンドの主要処理を実行（各ラウンドで圧縮関数を適用）</li>
                        <li>各ブロック処理後、結果を次のブロックの初期値として使用</li>
                    </ol>
                </li>
                <li><strong>最終ハッシュ値の出力</strong>：
                    <p>最後のブロック処理後の5つの変数を連結して160ビットのハッシュ値を生成</p>
                </li>
            </ol>
            
            <h4>SHA-2の手順（SHA-256を例に）</h4>
            <ol>
                <li><strong>前処理</strong>：
                    <ol>
                        <li>SHA-1と同様にパディングを行うが、最終的に512ビットの倍数にする</li>
                    </ol>
                </li>
                <li><strong>初期ハッシュ値の設定</strong>：
                    <p>8つの32ビット値（合計256ビット）を初期ハッシュ値として設定</p>
                </li>
                <li><strong>メッセージの処理</strong>：
                    <ol>
                        <li>メッセージを512ビットのブロックに分割</li>
                        <li>各ブロックを16個の32ビットのワードに分割</li>
                        <li>16ワードから64ワードに拡張（SHA-1より複雑な関数を使用）</li>
                        <li>8つの変数を初期ハッシュ値で初期化</li>
                        <li>64ラウンドの主要処理を実行（より複雑な圧縮関数を適用）</li>
                        <li>各ブロック処理後、結果を次のブロックの初期値として使用</li>
                    </ol>
                </li>
                <li><strong>最終ハッシュ値の出力</strong>：
                    <p>最後のブロック処理後の8つの変数を連結して256ビットのハッシュ値を生成</p>
                </li>
            </ol>
            
            <p>SHA-512など他のSHA-2バリエーションも同様の手順で処理されますが、ワードサイズ（64ビット）や初期値、ラウンド数などが異なります。</p>
            
            <h4>SHA-3の手順（SHA3-256を例に）</h4>
            <ol>
                <li><strong>スポンジ構造の初期化</strong>：
                    <p>内部状態（1600ビット）をすべて0で初期化</p>
                </li>
                <li><strong>入力の処理（吸収フェーズ）</strong>：
                    <ol>
                        <li>入力メッセージにパディングを適用し、レートr（SHA3-256では1088ビット）の倍数にする</li>
                        <li>パディング済みメッセージをrビットのブロックに分割</li>
                        <li>各ブロックと内部状態の最初のrビットをXOR</li>
                        <li>Keccak-f[1600]置換関数（24ラウンド）を適用</li>
                        <li>すべてのブロックが処理されるまで繰り返す</li>
                    </ol>
                </li>
                <li><strong>出力の生成（絞りフェーズ）</strong>：
                    <ol>
                        <li>内部状態の最初のrビットを出力バッファに追加</li>
                        <li>Keccak-f[1600]置換関数を適用</li>
                        <li>必要な出力長（この場合256ビット）が得られるまで繰り返す</li>
                    </ol>
                </li>
            </ol>
            
            <p>SHA-3は、SHA-1やSHA-2とは異なるスポンジ構造を使用しており、内部処理が大きく異なります。この構造により、SHA-3は様々な出力長に対応でき、また拡張出力機能（XOF）を提供できます。</p>
            
            <h3>計算量</h3>
            <p>SHA-1、SHA-2、SHA-3の計算量は以下の特性を持ちます：</p>
            
            <h4>SHA-1</h4>
            <ul>
                <li><strong>時間計算量</strong>：O(n) - 入力サイズに比例</li>
                <li><strong>空間計算量</strong>：O(1) - 内部状態のサイズは固定（約160ビット+作業領域）</li>
                <li>各512ビットブロックに対して80ラウンドの処理を実行</li>
            </ul>
            
            <h4>SHA-2</h4>
            <ul>
                <li><strong>時間計算量</strong>：O(n) - 入力サイズに比例</li>
                <li><strong>空間計算量</strong>：O(1) - 内部状態のサイズは固定（SHA-256で約256ビット+作業領域）</li>
                <li>SHA-256、SHA-224は各512ビットブロックに対して64ラウンドの処理を実行</li>
                <li>SHA-512、SHA-384、SHA-512/224、SHA-512/256は各1024ビットブロックに対して80ラウンドを実行</li>
                <li>SHA-2ファミリーはSHA-1よりも計算負荷が高い</li>
            </ul>
            
            <h4>SHA-3</h4>
            <ul>
                <li><strong>時間計算量</strong>：O(n) - 入力サイズに比例</li>
                <li><strong>空間計算量</strong>：O(1) - 内部状態のサイズは固定（1600ビット）</li>
                <li>各処理ブロックに対して24ラウンドのKeccak-f[1600]置換関数を適用</li>
                <li>SHA-3はSHA-2より理論的には効率的だが、多くのハードウェア実装ではSHA-2の方が速い場合がある</li>
            </ul>
            
            <p>すべてのSHAアルゴリズムにおいて、入力サイズに対して線形の時間計算量を持ち、固定サイズの内部状態を使用するため空間計算量は定数です。しかし、内部状態のサイズと各ブロック処理の複雑さはアルゴリズムによって異なります。</p>
            
            <p>実際のパフォーマンスは実装方法、ハードウェア最適化、並列処理の可能性などによって大きく変わる可能性があります。特にSHA-3（Keccak）は新しい設計であるため、ハードウェア実装の最適化がまだ進行中です。</p>
        </div>
    </div>
</body>
</html>
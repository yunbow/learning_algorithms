<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MD5</title>
    <link rel="stylesheet" href="./../../styles.css">
</head>
<body>
    <ul class="breadcrumb">
        <li><a href="./../../">アルゴリズムの学習</a></li>
        <li><a href="./../">ハッシュ文字列の問題</a></li>
        <li>MD5</li>
    </ul>
    <div class="container">
        <h1>MD5</h1>
        <div class="section">
            <h2>アルゴリズムの概要</h2>
            <p>MD5（Message-Digest Algorithm 5）は、任意の長さのデータを128ビットの固定長ハッシュ値に変換するハッシュ関数です。1991年にRonald Rivest（RSA暗号の開発者の一人）によって設計され、MD4の後継として開発されました。かつてはデータの整合性確認やパスワード保存など様々な用途で広く使用されていましたが、現在ではセキュリティ上の脆弱性が発見されているため、セキュリティを重視する用途での使用は推奨されていません。</p>
            
            <h3>基礎知識</h3>
            <p>MD5は暗号学的ハッシュ関数の一種で、以下の特性を持つように設計されました：</p>
            <ul>
                <li><strong>一方向性</strong>：MD5ハッシュ値から元のデータを復元することが計算量的に困難</li>
                <li><strong>決定性</strong>：同じ入力に対して常に同じハッシュ値を生成</li>
                <li><strong>高速計算</strong>：入力データから効率的にハッシュ値を計算できる</li>
                <li><strong>雪崩効果</strong>：入力の小さな変化でもハッシュ値が大きく変化する</li>
                <li><strong>衝突耐性</strong>：同じハッシュ値を持つ異なる入力を見つけることが困難（ただし、MD5は現在この性質を満たさないことが証明されています）</li>
            </ul>
            <p>MD5は128ビット（16バイト）のハッシュ値を生成し、通常は32桁の16進数文字列として表現されます。MD5の設計はメルクルダムゴード構造に基づいており、入力メッセージを512ビットのブロックに分割して処理します。</p>
            
            <h3>用語説明</h3>
            <ul>
                <li><strong>ハッシュ値（hash value）</strong>：ハッシュ関数によって生成された固定長の出力</li>
                <li><strong>メッセージダイジェスト（message digest）</strong>：ハッシュ値の別名で、MD5の「MD」はこれを指す</li>
                <li><strong>衝突（collision）</strong>：異なる入力データから同じハッシュ値が生成される状況</li>
                <li><strong>衝突攻撃（collision attack）</strong>：意図的に衝突を見つける攻撃手法</li>
                <li><strong>プリイメージ攻撃（preimage attack）</strong>：与えられたハッシュ値から、そのハッシュ値を生成する入力を見つける攻撃</li>
                <li><strong>第2プリイメージ攻撃（second-preimage attack）</strong>：ある入力とそのハッシュ値が与えられたとき、同じハッシュ値を持つ別の入力を見つける攻撃</li>
                <li><strong>パディング（padding）</strong>：入力データの長さを調整するために追加するビット列</li>
                <li><strong>圧縮関数（compression function）</strong>：ハッシュアルゴリズム内で使用される、固定長のブロックを処理する関数</li>
                <li><strong>メルクルダムゴード構造（Merkle–Damgård construction）</strong>：MD5を含む多くのハッシュ関数で使用される基本構造</li>
                <li><strong>レインボーテーブル（rainbow table）</strong>：事前計算されたハッシュ値のテーブルで、MD5などの脆弱なハッシュ関数の逆引きに使用される</li>
                <li><strong>ソルト（salt）</strong>：ハッシュ化前にデータに追加されるランダムな値で、レインボーテーブル攻撃を困難にする</li>
            </ul>
            
            <h3>特徴</h3>
            <ul>
                <li><strong>出力サイズ</strong>：128ビット（16バイト）のハッシュ値を生成し、通常は32文字の16進数として表現</li>
                <li><strong>処理速度</strong>：比較的高速で、大量のデータを効率的に処理できる</li>
                <li><strong>実装の容易さ</strong>：アルゴリズムが比較的シンプルで、多くのプログラミング言語や環境に実装されている</li>
                <li><strong>広範な互換性</strong>：長年使用されてきたため、多くのレガシーシステムでサポートされている</li>
                <li><strong>脆弱性</strong>：
                    <ul>
                        <li>1996年に設計上の弱点が発見され、2004年にはより深刻な脆弱性が証明された</li>
                        <li>2005年には衝突を見つける効率的なアルゴリズムが発表された</li>
                        <li>2008年以降、実用的な時間で衝突を生成することが可能になった</li>
                        <li>現在は、特殊なハードウェアを使用すると数秒で衝突を見つけることができる</li>
                    </ul>
                </li>
                <li><strong>セキュリティ評価</strong>：現在は暗号学的に安全ではないとされ、セキュリティを重視する場面ではSHA-2やSHA-3などの代替アルゴリズムの使用が推奨されている</li>
            </ul>
            
            <h3>適用ケース</h3>
            <p>MD5は以下のような用途で使用されてきましたが、セキュリティ上の懸念から多くの用途では代替アルゴリズムへの移行が進んでいます：</p>
            
            <h4>現在でも適している用途</h4>
            <ul>
                <li><strong>チェックサム計算</strong>：偶発的な破損の検出（セキュリティが重要でない場合）</li>
                <li><strong>ファイル識別</strong>：同一ファイルの高速な識別（悪意のある改ざんを考慮しない場合）</li>
                <li><strong>データ重複排除</strong>：同一データの検出（セキュリティが要件でない場合）</li>
                <li><strong>キャッシュインデックス</strong>：データキャッシュの効率的な索引付け</li>
                <li><strong>レガシーシステムとの互換性</strong>：既存システムの維持（セキュリティ要件が低い場合）</li>
            </ul>
            
            <h4>避けるべき用途</h4>
            <ul>
                <li><strong>パスワード保存</strong>：MD5は高速かつ並列計算が可能なため、総当たり攻撃に弱い。代わりにbcrypt、Argon2などを使用すべき</li>
                <li><strong>デジタル署名</strong>：衝突攻撃が実用的に可能なため、改ざんが検出できない可能性がある</li>
                <li><strong>SSL/TLS証明書</strong>：セキュリティプロトコルでの使用は非推奨</li>
                <li><strong>セキュリティトークン生成</strong>：予測可能性が高いため不適切</li>
                <li><strong>機密データの保護</strong>：現代の暗号基準を満たさない</li>
            </ul>
            
            <h4>代替アルゴリズム</h4>
            <p>セキュリティが必要な用途では、以下のアルゴリズムへの移行が推奨されています：</p>
            <ul>
                <li><strong>データ整合性確認</strong>：SHA-256、SHA-3</li>
                <li><strong>パスワード保存</strong>：bcrypt、Argon2、PBKDF2</li>
                <li><strong>デジタル署名</strong>：SHA-256、SHA-384、SHA-512、SHA-3</li>
                <li><strong>一般的なハッシュ用途</strong>：SHA-2ファミリー、SHA-3ファミリー、BLAKE2、BLAKE3</li>
            </ul>
            
            <p>MD5は現在でも広く使用されていますが、特にセキュリティが重要な場合は、より強力な代替アルゴリズムに移行することが強く推奨されています。単なるデータ識別や非セキュリティ目的では、その高速性と広範なサポートから、依然として使用されることがあります。</p>
        </div>
    
        <div class="section">
            <h2>アルゴリズムの手順</h2>
            <h3>具体的な手順</h3>
            <p>MD5アルゴリズムは、任意長の入力メッセージから128ビットのダイジェスト値を生成するために、以下の手順で処理を行います：</p>
            
            <ol>
                <li><strong>メッセージのパディング（前処理）</strong>：
                    <ol>
                        <li>メッセージの末尾に「1」ビットを追加</li>
                        <li>メッセージの長さが448 mod 512に等しくなるまで「0」ビットを追加（つまり、512ビットのブロックサイズで考えたとき、最後のブロックに64ビットの空きを残す）</li>
                        <li>元のメッセージ長を64ビットで表現し、追加（リトルエンディアン形式）</li>
                        <li>これにより、処理されるメッセージは512ビットの倍数長になる</li>
                    </ol>
                </li>
                <li><strong>初期値の設定</strong>：
                    <p>4つの32ビット値（合計128ビット）を初期ハッシュ値として設定：</p>
                    <ul>
                        <li>A = 0x67452301（16進数表記）</li>
                        <li>B = 0xEFCDAB89</li>
                        <li>C = 0x98BADCFE</li>
                        <li>D = 0x10325476</li>
                    </ul>
                </li>
                <li><strong>メッセージの処理</strong>：
                    <ol>
                        <li>パディング済みのメッセージを512ビット（64バイト）のブロックに分割</li>
                        <li>各ブロックについて以下の処理を行う：
                            <ol>
                                <li>現在のハッシュ値（A, B, C, D）をバッファ変数（a, b, c, d）にコピー</li>
                                <li>64ステップからなるメイン処理を実行
                                    <ul>
                                        <li>ステップは4つのラウンドに分かれ、各ラウンドは16ステップで構成</li>
                                        <li>各ラウンドでは異なる非線形関数F, G, H, Iを使用</li>
                                        <li>各ステップでは、バッファ値の一つを更新：a = b + ((a + 関数(b,c,d) + 入力ブロックの一部 + 定数) &lt;&lt; シフト量)</li>
                                        <li>4つのラウンドでは以下の非線形関数を使用：
                                            <ul>
                                                <li>ラウンド1（0-15）: F(x,y,z) = (x AND y) OR ((NOT x) AND z)</li>
                                                <li>ラウンド2（16-31）: G(x,y,z) = (x AND z) OR (y AND (NOT z))</li>
                                                <li>ラウンド3（32-47）: H(x,y,z) = x XOR y XOR z</li>
                                                <li>ラウンド4（48-63）: I(x,y,z) = y XOR (x OR (NOT z))</li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li>処理後、a, b, c, dの値を元のハッシュ値A, B, C, Dに加算</li>
                            </ol>
                        </li>
                        <li>すべてのブロックを処理するまで繰り返す</li>
                    </ol>
                </li>
                <li><strong>最終ハッシュ値の出力</strong>：
                    <ol>
                        <li>最終的なA, B, C, D値（各32ビット）を連結して128ビットのハッシュ値を生成</li>
                        <li>出力は通常、リトルエンディアンバイトオーダーで表現され、32桁の16進数として表示</li>
                    </ol>
                </li>
            </ol>
            
            <p>このアルゴリズムの特徴的な点は、4つの非線形関数の使用と、各ステップで異なる定数（正弦関数から導出）とシフト量を用いることです。これにより、入力の小さな変化が出力全体に伝播する「雪崩効果」を生み出しています。</p>
            
            <h3>計算量</h3>
            <p>MD5アルゴリズムの計算量特性は以下の通りです：</p>
            
            <ul>
                <li><strong>時間計算量</strong>：O(n) - 入力メッセージのサイズに比例
                    <ul>
                        <li>入力メッセージを512ビットのブロックに分割し、各ブロックに対して64ステップの処理を実行</li>
                        <li>各ステップは定数時間の操作（加算、論理演算、ビットシフト）のみを含む</li>
                        <li>処理速度は現代のハードウェアで非常に高速（1秒あたり数百MBを処理可能）</li>
                    </ul>
                </li>
                <li><strong>空間計算量</strong>：O(1) - 使用メモリは入力サイズに依存しない
                    <ul>
                        <li>処理に必要な主なメモリは、4つの32ビット値（A, B, C, D）と作業用バッファのみ</li>
                        <li>入力メッセージは連続的に処理されるため、全体を一度にメモリに保持する必要がない</li>
                        <li>追加の作業空間は固定サイズ（数百バイト程度）</li>
                    </ul>
                </li>
            </ul>
            
            <h4>性能特性</h4>
            <ul>
                <li><strong>パフォーマンス効率</strong>：MD5は高性能を重視して設計されており、SHA-1やSHA-2など多くの後継アルゴリズムよりも高速</li>
                <li><strong>並列処理</strong>：標準的なMD5はブロック間の依存関係があるため並列処理が困難だが、複数のファイルや独立したデータに対しては並列計算が可能</li>
                <li><strong>ハードウェア最適化</strong>：現代のCPUでは、命令セット拡張（SSE、AVX）を使用した高度に最適化された実装が可能</li>
                <li><strong>GPU実装</strong>：グラフィックプロセッサでの実装も効率的で、パスワードクラッキングなどで高いスループットを実現（1秒あたり数十億のハッシュ計算が可能）</li>
            </ul>
            
            <h4>セキュリティ特性</h4>
            <ul>
                <li><strong>衝突耐性</strong>：理論的には2^64回の操作で衝突を見つけられるが、現代の攻撃手法ではさらに少ない計算量で可能
                    <ul>
                        <li>2004年の攻撃：約2^40の複雑さで衝突を見つける方法が発見</li>
                        <li>2009年以降：特殊なハードウェアを使用すると数秒で衝突を生成可能</li>
                    </ul>
                </li>
                <li><strong>プリイメージ耐性</strong>：与えられたハッシュ値に対する元のメッセージを見つけるには、理論上2^128の複雑さが必要だが、実際にはいくつかの攻撃によって2^123程度まで削減されている</li>
                <li><strong>第2プリイメージ耐性</strong>：ある入力と同じハッシュ値を持つ別の入力を見つける攻撃に対しても、理論上は2^128の計算量が必要だが、MD5の構造的弱点によって一部のケースでは効率化されている</li>
            </ul>
            
            <p>これらの特性から、MD5はデータ処理効率が高く、チェックサム計算や非セキュリティ目的での使用には適していますが、現代の暗号学的セキュリティ要件を満たさないため、セキュリティが重要な場面では使用を避けるべきです。代わりに、SHA-256などのより強力なハッシュアルゴリズムの使用が推奨されます。</p>
        </div>
    </div>
</body>
</html>
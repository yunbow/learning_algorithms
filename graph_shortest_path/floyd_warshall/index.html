<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ワーシャル-フロイド法 (Floyd-Warshall)</title>
    <link rel="stylesheet" href="./../../styles.css">
</head>
<body>
    <ul class="breadcrumb">
        <li><a href="./../../">アルゴリズムの学習</a></li>
        <li><a href="./../">グラフの最短経路</a></li>
        <li>ワーシャル-フロイド法</li>
    </ul>
    <div class="container">
        <h1>ワーシャル-フロイド法 (Floyd-Warshall)</h1>
        <div class="section">
            <h2>アルゴリズムの概要</h2>
            <p>ワーシャル-フロイド法は、グラフ上のすべての頂点ペア間の最短経路を見つけるための効率的なアルゴリズムです。1962年にロバート・フロイドによって発表されましたが、同様のアルゴリズムはステファン・ワーシャルやバーナード・ロイによっても独立して発見されました。動的計画法に基づく単純かつ強力なアルゴリズムとして知られています。</p>
            
            <h3>基礎知識</h3>
            <p>グラフの最短経路問題とは、グラフ上の2つの頂点間を結ぶ最も短い（コストが最小の）経路を見つける問題です。ワーシャル-フロイド法は、グラフ上のすべての頂点ペアについて最短経路を一度に計算します。</p>
            <p>このアルゴリズムの基本的な考え方は、「2点間の経路において、中間点として特定の頂点を経由することで短くなるかどうか」を順次検証していくことです。すべての頂点について、この検証を行うことで全点対間の最短経路が求まります。</p>
            
            <h3>用語説明</h3>
            <ul>
                <li><strong>グラフ（Graph）</strong>: 頂点と辺の集合で構成される数学的構造</li>
                <li><strong>頂点（Vertex）</strong>: グラフの基本的な構成要素、ノードとも呼ばれる</li>
                <li><strong>辺（Edge）</strong>: 頂点同士を結ぶ線、接続関係を表す</li>
                <li><strong>重み付きグラフ（Weighted Graph）</strong>: 各辺に数値（重み、コスト）が割り当てられているグラフ</li>
                <li><strong>隣接行列（Adjacency Matrix）</strong>: グラフの構造を表す2次元配列</li>
                <li><strong>距離行列（Distance Matrix）</strong>: 頂点間の最短距離を格納する行列</li>
                <li><strong>動的計画法（Dynamic Programming）</strong>: 問題を部分問題に分割し、部分問題の解を記録し再利用する手法</li>
                <li><strong>最短経路（Shortest Path）</strong>: 2つの頂点間を結ぶ経路のうち、総コストが最小のもの</li>
                <li><strong>負の閉路（Negative Cycle）</strong>: 辺の重みの総和が負になる閉じた経路</li>
            </ul>
            
            <h3>特徴</h3>
            <p>ワーシャル-フロイド法の主な特徴は以下の通りです：</p>
            <ul>
                <li>すべての頂点ペア間の最短経路を一度に計算できる</li>
                <li>実装が非常にシンプルで、コードがわずか数行で記述可能</li>
                <li>負の重みを持つ辺にも対応可能（ただし負の閉路がない場合）</li>
                <li>動的計画法の典型的な応用例</li>
                <li>隣接行列表現を使用するため、密なグラフでは特に効率的</li>
                <li>負の閉路の検出にも使用可能</li>
                <li>経路自体（どの頂点を経由するか）の復元も容易に行える</li>
            </ul>
            
            <h3>適用ケース</h3>
            <p>ワーシャル-フロイド法は以下のような場面で特に有用です：</p>
            <ul>
                <li>すべての頂点ペア間の最短距離を求める必要がある場合</li>
                <li>グラフが比較的小規模（数百頂点程度まで）である場合</li>
                <li>グラフに負の重みを持つ辺が含まれる場合</li>
                <li>グラフ内の負の閉路を検出したい場合</li>
                <li>中継点の情報も含めた経路復元が必要な場合</li>
                <li>ネットワークの信頼性分析（最大フロー問題など）</li>
                <li>コンピュータネットワークのルーティングテーブル計算</li>
                <li>交通網や通信網の最適経路計画</li>
                <li>グラフの推移的閉包（transitive closure）を求める場合</li>
            </ul>
        </div>
    
        <div class="section">
            <h2>アルゴリズムの手順</h2>
            <h3>具体的な手順</h3>
            <p>ワーシャル-フロイド法の基本的な手順は以下の通りです：</p>
            <ol>
                <li>n×n の距離行列 D を初期化する（n はグラフの頂点数）：
                    <ul>
                        <li>D[i][i] = 0（同じ頂点への距離はゼロ）</li>
                        <li>D[i][j] = 頂点i から頂点j への辺の重み（辺が存在する場合）</li>
                        <li>D[i][j] = ∞（無限大、実装では十分大きな値）（辺が存在しない場合）</li>
                    </ul>
                </li>
                <li>すべての頂点 k について以下を実行（外側のループ）：
                    <ul>
                        <li>すべての頂点ペア (i, j) について：
                            <ul>
                                <li>もし D[i][k] + D[k][j] < D[i][j] ならば、D[i][j] = D[i][k] + D[k][j] に更新する</li>
                                <li>（つまり、頂点 k を経由する経路の方が短い場合は、距離を更新する）</li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li>アルゴリズム終了後、D[i][j] は頂点 i から頂点 j への最短経路の距離を表す</li>
            </ol>
            
            <p>このアルゴリズムは、すべての頂点を中間頂点として考慮し、その頂点を経由することで短くなる経路があれば更新していく、という操作を繰り返します。</p>
            
            <h4>具体例: 4頂点グラフの最短経路を計算する場合</h4>
            <p>以下のような4頂点からなる重み付き有向グラフを考えます：</p>
            <ul>
                <li>頂点0から頂点1への辺の重み: 3</li>
                <li>頂点0から頂点2への辺の重み: 8</li>
                <li>頂点1から頂点2への辺の重み: 2</li>
                <li>頂点2から頂点0への辺の重み: 5</li>
                <li>頂点2から頂点3への辺の重み: 1</li>
                <li>頂点3から頂点1への辺の重み: 4</li>
            </ul>
            
            <p>初期の距離行列 D は次のようになります（∞は実装上は十分大きな値）：</p>
            <pre>
    0   1   2   3
0   0   3   8   ∞
1   ∞   0   2   ∞
2   5   ∞   0   1
3   ∞   4   ∞   0
            </pre>
            
            <p>各頂点を中間頂点として考慮していきます：</p>
            <ol>
                <li>頂点0を中間頂点として考慮：
                    <pre>
    0   1   2   3
0   0   3   8   ∞
1   ∞   0   2   ∞
2   5   8   0   1
3   ∞   4   ∞   0
                    </pre>
                    <p>（D[2][1]が∞から8に更新された - 頂点2→0→1の経路）</p>
                </li>
                <li>頂点1を中間頂点として考慮：
                    <pre>
    0   1   2   3
0   0   3   5   ∞
1   ∞   0   2   ∞
2   5   8   0   1
3   ∞   4   6   0
                    </pre>
                    <p>（D[0][2]が8から5に更新された - 頂点0→1→2の経路）</p>
                    <p>（D[3][2]が∞から6に更新された - 頂点3→1→2の経路）</p>
                </li>
                <li>頂点2を中間頂点として考慮：
                    <pre>
    0   1   2   3
0   0   3   5   6
1   7   0   2   3
2   5   8   0   1
3   11  4   6   0
                    </pre>
                    <p>（複数の値が更新されました）</p>
                </li>
                <li>頂点3を中間頂点として考慮：
                    <pre>
    0   1   2   3
0   0   3   5   6
1   7   0   2   3
2   5   7   0   1
3   11  4   6   0
                    </pre>
                    <p>（D[2][1]が8から7に更新された - 頂点2→3→1の経路）</p>
                </li>
            </ol>
            
            <p>最終的な距離行列が、すべての頂点ペア間の最短経路の距離を表します。例えば、頂点0から頂点3への最短距離は6となります。</p>
            
            <h3>計算量</h3>
            <p>ワーシャル-フロイド法の計算量は以下の特性を持ちます：</p>
            <ul>
                <li><strong>時間計算量</strong>: O(n³)
                    <ul>
                        <li>n は頂点数</li>
                        <li>3重ループ構造（外側のループが頂点k、内側の2重ループが頂点ペア(i,j)）</li>
                        <li>各操作は定数時間</li>
                    </ul>
                </li>
                <li><strong>空間計算量</strong>: O(n²)
                    <ul>
                        <li>n×n の距離行列を保持するため</li>
                        <li>経路復元のための前任者行列を保持する場合も同様に O(n²)</li>
                    </ul>
                </li>
            </ul>
            
            <p>時間計算量が O(n³) であるため、頂点数が多いグラフ（数千頂点以上）に対しては計算時間が膨大になる可能性があります。そのため、大規模グラフでは他のアルゴリズム（例えばダイクストラ法を複数回実行するなど）の方が効率的な場合があります。</p>
            
            <p>しかし、すべての頂点ペア間の最短経路を求める問題に対しては、ワーシャル-フロイド法の O(n³) という時間計算量は最適であることが知られています。特に、グラフが密である（辺の数が頂点数の2乗に近い）場合には、他のアルゴリズムよりも効率的に動作することがあります。</p>
            
            <p>また、アルゴリズムの構造がシンプルであるため、実装が容易であり、定数項が小さいという利点もあります。これにより、中規模までのグラフ（数百頂点程度まで）であれば、実用的な時間内で計算が可能です。</p>
        </div>
    </div>
</body>
</html>